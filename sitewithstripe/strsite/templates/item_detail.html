<!DOCTYPE html>
<html>
<head>
    <title>Item Details</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>{{ item.name }}</h1>
    <p>{{ item.description }}</p>
    <p>Price: ${{ item.price }}</p>
    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" min="1" value="1">
    <p>Total: $<span id="total">{{ item.price }}</span></p>
    <button id="checkout-button">Buy</button>

    <a href="{% url 'item_list' %}">Список товаров</a>


    <script>
        var stripe = Stripe('pk_test_51NsTBiF6oMer2mpJ1lL7oQUh2mlxIwCGlPEr7BP7Z0O6MlcFADCgD786WIdCYwUqfWzUjGpOWycKl6FWLjuCcA0E00wdcrCIN1');  // Замените на ваш публичный ключ Stripe
        var checkoutButton = document.getElementById('checkout-button');
        var quantityInput = document.getElementById('quantity');
        var totalSpan = document.getElementById('total');

        function updateTotal() {
            var quantity = quantityInput.value;
            var price = {{ item.price }};  // Цена товара из контекста шаблона
            var total = quantity * price;
            totalSpan.textContent = total.toFixed(2);  // Отображаем общую сумму с двумя десятичными знаками
        }

        // Обработчик события для изменения количества
        quantityInput.addEventListener('change', updateTotal);

        checkoutButton.addEventListener('click', function () {
            var item_id = {{ item.id }};  // ID товара из контекста шаблона
            var quantity = quantityInput.value;  // Количество товара
            fetch(`/buy/{{ item.id }}?quantity=${quantity}`)
                .then(function (response) {
                    return response.json();
                })
                .then(function (session) {
                    return stripe.redirectToCheckout({ sessionId: session.session_id });
                })
                .then(function (result) {
                    if (result.error) {
                        console.error(result.error.message);
                    }
                })
                .catch(function (error) {
                    console.error(error);
                });
        });
    </script>
</body>
</html>